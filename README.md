# CPU-experiment

```html
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->



<!-- END doctoc generated TOC please keep comment here to allow auto update -->
```



# 前準備

Slack開設

Githubアカウント作成

# 目的

## 最終目標：

- シングルサイクルCPUで足し算を行うこと

命令セットはMIPSでもRISC-Vでもどちらでも良い。まずは教科書にあるMIPS命令セットでCPUを作り、その後RISC-Vに換装するのが良いと思う。

### 付属して付く技術

VerilogHDLの扱い、シミュレーション

論理回路の理解

（最低限の）CPU、コンピュータ・アーキテクチャに関する理解や技術

# はじめまして

吉岡の自己紹介

みんなの自己紹介

ペアを作成

# このセミナー開始にあたって

この授業の目的は**研究体験**であると解釈しています。まず研究と授業は全然違います。授業は基本的に受け身でよく、最悪授業に出席し言われた通りの範囲を勉強しレポートやテストに望めばOKです。

一方で研究は最先端の更にその先を目指す行為です。そのため教員もまだ知らないことも勉強する必要があり、研究遂行に必要な知識やスキルを教員が全て丁寧に教えることはありません（というか無理です）。もちろんベースとなる技術や論文、教科書を最初に提示しますし、輪講などで基本は教えます（それは教員の義務です）が卒論・修論を書くには**自分で情報を調べること**がかなり重要となります。

これは会社に入っても同様であり、今はどの会社でも新人研修よりもOJTで仕事スキルを付けることが多いかと思います。OJTというと聞こえは良いのですが、メンターは自分の仕事をしながらあなたの指導をするので大学の授業のように懇切丁寧に教えてくれるわけではなく、要点を絞って自分で調べてもわからない範囲で質問をする必要があります。なので研究における姿勢と仕事の姿勢はちょっと似ていますね。

### 10分質問ルール

じゃあ質問するなってこと。。？というのは少し違います。

わかりやすく今回のセミナーで適応したいルールにGoogle Brainの15 minute ruleがあります。

[Google人工知能チームの「15分ルール」 - BppLOG](https://tkybpp.hatenablog.com/entry/2016/08/16/173055)

問題が起きた時は

【1】最初の15分は自分自身で解決を試みる【2】15分後も解決していなかったら必ず人に聞く

15分以内で自分で考えず、調べずに質問するのは他者の時間の無駄である。

15分以上自分で考えるのは自分の時間を無駄にしているので**必ず質問をする**、というのが15分ルールです。

今回のセミナーではわからないことだらけなので10分調べたりしてもわからなかったらSlackや吉岡がそこにいたら聞く、というルールで運用しましょう。**（これは実際の設計時の話で環境設定では遠慮なく聞いてください）**

できるだけ**Slackの公開チャネル（Question）**で聞くと他の人にも共有できるため、推奨しています。

# 1日目

### 環境設定

* Slack、githubを整備（行っているはず）

  ### シミュレータ(Modelsim)の準備

https://sites.google.com/site/playsystemverilog/

の手順に従い、`ModelSim`をインストールします。

https://drive.google.com/file/d/1X2uY70ez27wvgCxB3hqmlao8dA3sdv7_/view?usp=sharing

Windows、Linux使用の方は上記のリンクからModelSimをダウンロードし、インストールしてください。



ModelSimは記述したハードウェアコード（Verilog)のコンパイラ＋シミュレータとなっています。ハードウェアでは波形表示で結果を見ることが多く、GUIソフトが必要となり結果としてファイルサイズなども大きくなってしまいます。ModelSimAlteraはフリーの古いソフトですが、今回の実験に必要な結果は得られるはずです。XIlinx社のVivadoの方が高性能ですが有料だったため今回は見送りました。



(MACの方向け)

https://qiita.com/RotaryKer/items/d8f6d218962c213b0577

Brewでシミュレータが入ります。試してみてください。



* (インストールできたら)ModelSimの動作テスト

  ⇨説明を元に`00_helloworld_verilog/helloworld.v`を実行してみましょう。

* 半加算器をModelSimで動かそう

  （参考）Verilogのテストベンチの書き方

  https://www.macnica.co.jp/business/semiconductor/articles/intel/110605/

* (開発環境について）吉岡は`VScode`を使用してverilogを書いています。
  VerilogだけではなくPythonを書くに至っても文法チェックなど便利なのでよかったら入れてみてください。

  https://azure.microsoft.com/ja-jp/products/visual-studio-code/

* （参考）Verilogの書き方について

  Verilogについて良い教科書はあまりないです。。例えばQiitaのこの記事

  https://qiita.com/thtitech/items/8cc898dda7a10780f495

  など参照してください。

### テキスト

本セミナーでは**ディジタル回路設計とコンピュータアーキテクチャ[ARM版]**をベースに勉強します。この本はCPUの作り方まで勉強できる上、比較的わかりやすく書かれています。

3章までは必修のディジタル・アナログ回路の復習ですがデジタル回路は後半なのでまだ履修していないかもですね。

最初から読んでいきましょう、そして4章以降は新たに学ぶ内容です。

まず今日は4章の途中まで読むことを目標としましょう。

そして4章に書いてある例題をいくつかVerilogで記述し動作を確認してみましょう。



## 1日目終了後課題

1.  入力a,bを与えられてa>bならば1を、a≦bならば0を出力する比較器を設計してください。
2. 入力aを入力bでビットシフト（2^b倍する）回路を設計してください。
3. a*bを行う掛け算回路を設計してください。
4. 組み合わせ回路と順序回路の違いを説明してください。
5. 2.8章の2:1マルチプレクサを実装してください。
6. 4:1マルチプレクサを実装してください。
7. 2:4デコーダを実装してください。
8. (チャレンジ課題）テキスト1.4章にある通り、与えられた加算器は符号付き2の補数を用いたものでした（Verilogでは特に宣言をしないと2の補数で実装されます）符号なし表現を用いた（uintと呼ばれます)加算器を作ってみてください。
9. Dフリップフロップはとても重要な回路です。回路動作を説明できるようにしてください。

詰まったら4章を見てみると実装が載っています。確認してみて下さい。

# 2日目

・`4.1-4.4, 4.9`を読む。

・`5.1-5.2, 5.4`を読む。（CPU設計にそこまで関係ないので流し読みで良いです）

・6章はCPU設計の本質です。`6.1-6.4`を本気で読みましょう。

Slackで送った課題が終わっていない方は課題にチャレンジしてみよう。

## 2日目課題
1. カウンタ回路を設計してください。0から255までの値を数えられるように設計し、テストベンチで確認してください。
（カウンタ回路はクロックが入るたびに出力が1増える回路です。
リセット信号をもたせ、リセットが1の時は出力は0になり、リセットが0の時はカウンタ動作するようにしてください）

2. 足し算、引き算、掛け算の機能を切り替えられる演算器（ALU)を設計してください。
入力はa, bそれぞれ32bitで出力も32bitとしてください。
2bitのsel（セレクタ）信号を受け取り、000の時は足し算、001の時は引き算、010の時は掛け算となるように設計してください。

# 3日目

工事中

テキスト7章を読みながらシングルサイクルCPUを組もう！

足し算を動かそう。RISC-Vの命令セットに改造しよう。
